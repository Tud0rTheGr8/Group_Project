---
title: "An Analysis of factors that affect race completion times and probability of winning in Formula E"
author: "by Team-Name: Tudor Cucu, Binxi Yang, Jiacheng Zhang, Mengchuan Sun"
date: "29 Nov 2023`"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load-lib, include = FALSE}
library(tidyverse)
library(lubridate)
# Add any other libraries here



```


```{r load-data, include=FALSE}
# load your data here and any pre-processing/cleaning 
#  that you need for your report.
formula_e <- read.csv("data/formula_e_race_results.csv")
formula_e <- formula_e %>% mutate(race_city = substring(race_name,6))
head(formula_e %>% mutate(race_date = ymd(race_date)) %>% arrange(race_date),10)
```



## Research Question

How do average race completion times vary over time and what factors affect the rank achieved by race drivers? This information could be used to predict which teams are more likely to win certain races and gain insights into how some teams build their cars.





## Data

We used the Formula E Championship dataset (referenced at the end of the document). This dataset was derived from Wikipedia race reports by the author. As such, there were various inconsistencies within the data, especially with regards to the time_retired variable. The main variables of interest for our investigation were the time_retired (detailing the time taken to complete the race), team, race_name (including the city in which the race took place as well as the year) and rank variables.






## Findings

We started of by tidying the data, creating a new variable called race_city which only included the name of the city the race took place in. We used this variable as a stand-in for the race track (which wasn't included in the dataset) under the assumption that all races in the same city would take place on the same track.

The first step in our analysis was to create a graph showcasing the evolution of rank 1 times over the seasons in a few selected cities, which had the largest number of races in order to have as many data points as possible. We decided to plot separate lines for separate cities as the different lengths of different tracks may lead to false conclusions if they were all considered together. In order to do this, we had to modify the time_retired variable to a standard hms (lubridate) format and then into seconds, as the data for the rank 1 times was in a variety of different formats.

Our expectations were that rank 1 times would go down over the seasons as the drivers gain more experience with the tracks and as the technology in the cars advances. The plot for the following cities: Berlin, Marrakesh, Mexico City and Paris can be seen below. 

```{r choose rank 1 data, message=FALSE, warning=FALSE, echo=FALSE}
formula_e_rank1 <- filter(formula_e, rank==1) %>%
  select(., season, race_city, time_retired) %>% arrange(season) %>%
  mutate(time_retired = case_when(nchar(time_retired) == 9 ~ paste0("0:", time_retired),
                                  nchar(time_retired) > 9 ~ time_retired)) %>%
  filter(is.na(time_retired) == FALSE)
  

formula_e_rank1_mini <- formula_e_rank1 %>%
  filter(race_city == "Berlin" | 
           race_city == "Marrakesh" |
           race_city == "Mexico City" |
           race_city == "Paris")

formula_e_rank1_mini <- formula_e_rank1_mini %>%
  mutate(time_retired = as.numeric(seconds(hms(time_retired))))



formula_e_rank1_mini %>%
  ggplot(mapping = aes(x = season, y = time_retired, color = race_city, group_by=race_city)) +
  geom_point() +
  geom_smooth(se = FALSE, method = "lm", formula='y~x') +
  labs(title = "Evolution of Rank 1 times over time in selected cities",
       x = "Season",
       y = "Time (s)",
       color = "Race City")
  

```

## References

Dataset: 

MLandry, 2020, Formula E Championship, Electronic Dataset, Kaggle.com, <20, Oct, 2023: https://www.kaggle.com/datasets/mlandry/formula-e-championship>

References: 

Wikipedia, 2023, List of Formula E ePrix, Wikipedia, <26, Nov, 2023: https://en.wikipedia.org/wiki/List_of_Formula_E_ePrix>
